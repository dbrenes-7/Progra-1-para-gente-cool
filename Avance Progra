#include <stdio.h>
#include <stdlib.h>
#include <string.h>//strstr()

typedef struct registroSala registroSala;

struct registroSala{
    char id[20];
    char ubicacion[200];
    int capacidad;
    char recursos[200];
    char estado[50];
    int calificacion;
};

struct Estudiante{
    char nombre[100];
    char carrera[100];
    char correo[200];
    int carnet, numero;
}est;


void agregarSala(){
    char capacidad[10];
    int numSalas;

    printf("Ingrese la cantidad de salas que agregara: ");
    scanf("%d",&numSalas);

    registroSala registroSala[numSalas];
    FILE *Archivo;
    Archivo = fopen("Registro","a");

    for (int i = 0; i < numSalas; ++i) {
        printf("\nIngrese el ID de la sala %i: ",i+1);
        scanf("%s",&registroSala[i].id);
        printf("\nIngrese la ubicacion de la sala %i: ",i+1);
        scanf("%s",&registroSala[i].ubicacion);
        printf("\nIngrese la capacidad de la sala %i: ",i+1);
        scanf("%s",&capacidad);
        registroSala[i].capacidad = atoi(capacidad);
        printf("\nIngrese los recursos de la sala %i: ",i+1);
        scanf("%s",&registroSala[i].recursos);
        printf("\nIngrese el estado de la sala %i: ",i+1);
        scanf("%s",&registroSala[i].estado);
        registroSala[i].calificacion = 100;
        printf("\nID: %s\nUbicacion: %s\nCapacidad: %i\nRecursos: %s\nEstado: %s\nCalificacion: %i",registroSala[i].id,registroSala[i].ubicacion,registroSala[i].capacidad,registroSala[i].recursos,registroSala[i].estado,registroSala[i].calificacion);
        fprintf(Archivo,"\nID: %s\nUbicacion: %s\nCapacidad: %i\nRecursos: %s\nEstado: %s\nCalificacion: %i",registroSala[i].id,registroSala[i].ubicacion,registroSala[i].capacidad,registroSala[i].recursos,registroSala[i].estado,registroSala[i].calificacion);
    }
    fclose(Archivo);
}

void consultarSalas(char sala[20]){
    char linea[1024];
    FILE *fich;
    fich = fopen("Registro.txt", "r");
    while(fgets(linea, 1024, (FILE*) fich)) {//esto agarra linea por linea toodo el documento
        if(strcmp(sala,linea)==0){//esto agarra la sala ingresada en la funcion y dice si la encuentra en el documento
            printf("Sala Encontrada\n");
            printf("%s",linea);
            return;
        }
        else{
            printf("Esta sala no se ha encontrado en archivo\n");
        }

    }
    fclose(fich);
}

void prueba()
{
    printf("Indique el nombre: ");
    gets(est.nombre);
    printf("Indique la carrera: ");
    gets(est.carrera);
    printf("Indique el correo: ");
    gets(est.correo);
    printf("Indique el carnet: ");
    scanf("%d",&est.carnet);
    printf("Indique el numero telefonico: ");
    scanf("%d",&est.numero);
    FILE *ptr;
    ptr = fopen("nuevo.txt", "a+");
    if (ptr==NULL)
    {
        printf("NO");
        return 0;
    }
    fwrite(&est, sizeof(est), 1, ptr);
    printf("DATOS GUARDADOS...");

    fclose(ptr);
}

void pruebalectura()
{
    int contador = 0;
    FILE *ptr;
    ptr = fopen("nuevo.txt", "r");
    if (ptr==NULL)
    {
        printf("NO");
        return;
    }
    while(!feof(ptr))
    {
        fread(&est, sizeof(est), 1, ptr);
        if (contador==0){
        printf("\Nombre: %s \nCarrera: %s \nCorreo: %s \nCarnet: %d\nNumero: %d \n", est.nombre, est.carrera, est.correo, est.carnet, est.numero);
    }
    contador++;
}
fclose(ptr);
}

void pruebabusqueda()
{
    char nom[20];
    FILE *ptr;
    ptr = fopen("nuevo.txt", "a+");
    if (ptr==NULL)
    {
        printf("NO");
        return;
    }
    printf("Inserte el nombre que desea buscar: ");
    gets(nom);
    while(!feof(ptr))
    {
        fread(&est, sizeof(est), 1, ptr);
        if (strstr(nom,est.nombre)!= NULL){
        printf("\Nombre: %s \nCarrera: %s \nCorreo: %s \nCarnet: %d\nNumero: %d \n", est.nombre, est.carrera, est.correo, est.carnet, est.numero);
    }
}
fclose(ptr);
}


void main(){
    pruebabusqueda();


    return 0;
}
